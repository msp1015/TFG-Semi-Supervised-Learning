{% extends "base.html" %} {% from "macros.html" import modalerror %} {% block
head %} {{ super() }}
<script type="text/javascript" src="/js/visualizacion/d3.min.js"></script>
<script type="text/javascript" src="/js/visualizacion/inicializar.js"></script>
<script type="text/javascript" src="/js/visualizacion/grafos.js"></script>
<script type="text/javascript" src="/js/visualizacion/pasos_grafos.js"></script>
<script
  type="text/javascript"
  src="/js/visualizacion/funciones_comunes.js"
></script>
<meta name="csrf-token" content="{{ csrf_token() }}" />
{% endblock %} {% block content %}
<button id="btn_volver" type="button" onclick="history.back()" class="btn">
  <i class="bi bi-caret-left-fill"></i>{{ gettext('Go back') }}</button
>| {{ gettext('Dataset') }}: {{ session['FICHERO']|nombredataset }}
<br />
<div id="titulo_visualizacion" class="text-center pb-3">
  <h1 class="title-mulish text-bold">
    {{ gettext('Graphs')}}: {{gettext(nombreGrafo)}} |
    {{gettext(nombreInferencia)}}
  </h1>
  <hr class="separacion w-12" />
</div>
<div id="div_cargando">
  <div id="cargando" class="cargando m-auto"></div>
</div>
<div
  id="visualizacion"
  style="visibility: hidden"
  class="d-flex flex-wrap justify-content-around mb-3 position-relative"
>
  <div id="visualization-card" class="col-md">
    <div class="m-2 p-2 shadow-lg rounded-4 sticky-top">
      <div class="text-center position-relative">
        <h4 class="title-mulish">{{ gettext('Main visualization')}}</h4>
        <hr class="separacion w-10" />
        <div
          id="zona_gráfico"
          class="d-flex mt-4 justify-content-center align-items-center"
        >
          <div class="d-flex">
            <div class="position-relative" id="visualizacion_principal"></div>
            <div
              id="leyenda_visualizacion"
              class="d-flex flex-column align-items-start m-auto"
              style="width: 7rem"
            ></div>
          </div>
        </div>
        <div class="text_center" id="controles">
          <button id="reiniciar_zoom" class="btn btn-light">
            {{ gettext('Zoom reset') }}
          </button>
          <br /><br />
          <label id="iteracion">{{gettext('Initial Data')}}</label>
          <div class="rounded-4 p-2">
            <div class="progress m-auto" style="width: 30rem">
              <div
                id="progreso"
                class="progress-bar gold"
                role="progressbar"
                aria-valuemin="0"
              ></div>
            </div>
          </div>
          <button id="previt" class="btn btn-primary">
            <i class="bi bi-chevron-double-left"></i>
          </button>
          <button id="reproducir" class="btn btn-primary">
            <i class="bi bi-play-fill"></i>
          </button>
          <button id="nextit" class="btn btn-primary">
            <i class="bi bi-chevron-double-right"></i>
          </button>
          <button id="inferir_etiq" class="btn btn-success disabled">
            {{ gettext('Infer labels') }}
          </button>
        </div>
        <br />
      </div>
    </div>
  </div>
  <div id="pasos_grafos" class="col-md">
    <div class="m-2 p-2 shadow-lg rounded-4 sticky-top">
      <div class="text-center">
        <h4 class="title-mulish">{{ gettext('Algorithm Steps') }}</h4>
        <hr class="separacion w-10" />
        <div class="btn-group btn-group-toggle">
          <label class="btn btn-outline-primary active" id="btn-fases-grafo">
            {{ gettext('Graph phases') }}
          </label>
          <label class="btn btn-outline-success disabled" id="btn-inferencia">
            {{ gettext('Inference results') }}
          </label>
        </div>
      </div>

      <div id="fases_grafo" class="m-2 p-2">
        {% include '/visualizacion/' ~ nombreGrafo ~ '.html' %}
      </div>
    </div>
  </div>
</div>
{{ modalerror() }}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const steps = document.querySelectorAll(".pseudo-step");
    let currentStep = 0;

    function updateStepDisplay() {
      steps.forEach((step, index) => {
        step.style.display = index === currentStep ? "block" : "none";
      });
    }

    document.getElementById("previt").addEventListener("click", () => {
      currentStep = Math.max(0, currentStep - 1);
      updateStepDisplay();
    });

    document.getElementById("nextit").addEventListener("click", () => {
      currentStep = Math.min(steps.length - 1, currentStep + 1);
      updateStepDisplay();
    });

    // Inicializar la visualización del primer paso
    updateStepDisplay();
  });
</script>
<script>

  /**
   *
   * Centraliza traducciones de las visualizaciones accediendo
   * a las traducciones con la misma clave que el texto.
   *
   * @param texto - texto a traducir.
   * @returns {*} - texto traducido.
   */
  function traducir(texto) {
      let traducciones = {
          'Initial data': "{{ gettext('Initial data') }}",
          'Label': "{{ gettext('Label') }}",
          'Classifier': "{{ gettext('Classifier') }}",
          'Classifier: Not classified': "{{ gettext('Classifier: Not classified') }}",
          'Label: Not classified': "{{ gettext('Label: Not classified') }}",
          'Measure': "{{ gettext('Measure') }}",
          'Iteration': "{{ gettext('Iteration') }}",
          'Point': "{{ gettext('Point') }}",
          'Position': "{{ gettext('Position') }}",
          'overlapping points': "{{ gettext('overlapping points') }}",
          'Warning': "{{ gettext('Warning') }}"
      }

      let pasos_gbili = {
          'GBILI_0': "{{gettext('Initial data')}}",
          'GBILI_1': "{{gettext('K nearest neighbors')}}",
          'GBILI_2': "{{gettext('Mutual K nearest neighbors')}}",
          'GBILI_3': "{{gettext('Minimum distances')}}",
          'GBILI_4': "{{gettext('Final graph')}}"
      }

      let pasos_rgcli = {
          'RGCLI_0': "{{gettext('Initial data')}}",
          'RGCLI_1': "{{gettext('Ke nearest neighbors')}}",
          'RGCLI_2': "{{gettext('Final graph')}}"
      }

      if (texto in traducciones || texto in pasos_gbili || texto in pasos_rgcli) {
          return traducciones[texto] || pasos_gbili[texto] || pasos_rgcli[texto]
      }

      return texto
  }

  /* Datos para la petición POST de la ejecución del algortimo.
  * Es decir, cada elemento es uno de los parámetros configurados */
  let elementos = [];

  {% for param in params %}
      elementos.push({nombre: "{{ param.nombre }}", valor: "{{ param.valor }}"});
  {% endfor %}

  let cx = "{{ cx }}", cy = "{{ cy }}";

  var nombreAlgoritmo = "{{ nombreGrafo }}";

  document.addEventListener('DOMContentLoaded', function () {
      let steps = [
          {
              title: "{{ gettext("Visualization area") }}",
              intro: "{{ gettext("This page is the heart of the application. Here, you can observe graph based algorithm training process.") }}"
          },
          {
              element: '#visualizacion_principal',
              intro: "{{ gettext("This chart will display the graph phases of the algorithm. It's interactive; you can zoom in, scroll around, or select a data point (to display relevant information).") }}"
          },
          {
              element: '#controles',
              intro: "{{ gettext("You can proceed through the algorithm steps manually or automatically while visualizing the events.") }}"
          },
          {
              element: '#pasos_grafos',
              intro: "{{ gettext("This is where you can see the steps explained theoretically, plus a summary of results.") }}",
              position: 'left'
          }
      ];

      document.getElementById('inicio_tutorial').addEventListener('click', function () {
          this.style.animation = "none";
          introJs().setOptions({
              steps: steps,
              'nextLabel': "{{ gettext("Next") }}",
              'prevLabel': "{{ gettext("Previous") }}",
              'doneLabel': "{{ gettext("Done") }}",
          }).start();
      });
  });
</script>

{% if ejecutar %}
<script>
  inicializar("/datos/{{ session['ALGORITMO'] }}", elementos)
    .then(function (datos) {
      inicializarDatos(datos);

      inicializarGrafo();
      updateGraph();
    })
    .catch(function (error) {
      console.log(error);
    });
</script>
{% else %}
<script>
  document.getElementById("div_cargando").remove();
  document.getElementById("visualizacion").style.visibility = 'visible';
  document.getElementById("titulo_visualizacion").style.visibility = 'visible';
  let datos = {{ json_data|tojson }};
  inicializarDatos(datos);
  inicializarGrafo();
  updateGraph();
</script>
{% endif %} {% endblock %}
